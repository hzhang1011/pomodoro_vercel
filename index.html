<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>番茄钟 · 完整可倒计时 + 日夜模式 + 全屏</title>
<style>
:root {
  --bg-gradient: linear-gradient(135deg, #6dd5ed, #2193b0);
  --card: rgba(255,255,255,0.1);
  --accent-gradient: linear-gradient(90deg,#ff6b6b,#ff8c42);
  --text-main: #fff;
  --text-muted: #fff3b0;
  --mode-active: #ffd166;
}
[data-theme="dark"] {
  --bg-gradient: linear-gradient(135deg, #0f1724, #1e293b);
  --card: rgba(255,255,255,0.05);
  --accent-gradient: linear-gradient(90deg,#ff6b6b,#ff8c42);
  --text-main: #e6eef6;
  --text-muted: #94a3b8;
  --mode-active: #ffd166;
}
[data-theme="light"] {
  --bg-gradient: linear-gradient(135deg, #a1c4fd, #c2e9fb);
  --card: rgba(255,255,255,0.8);
  --accent-gradient: linear-gradient(90deg,#ff8c42,#ff6b6b);
  --text-main: #1e293b;
  --text-muted: #475569;
  --mode-active: #ff8c42;
}
*{box-sizing:border-box;}
body{
  margin:0;
  font-family: Inter,ui-sans-serif,system-ui,-apple-system,"Helvetica Neue",Arial;
  background: var(--bg-gradient);
  color: var(--text-main);
  display:flex;
  align-items:center;
  justify-content:center;
  height:100vh;
}
.wrap{
  width:min(760px,95%);
  padding:28px;
  background: var(--card);
  border-radius:14px;
  box-shadow:0 8px 30px rgba(0,0,0,0.3);
  display:grid;
  grid-template-columns:1fr 320px;
  gap:18px;
}
@media (max-width:820px){.wrap{grid-template-columns:1fr;padding:18px}}
header{grid-column:1/-1;display:flex;align-items:center;justify-content:space-between;gap:12px}
h1{margin:0;font-size:18px;letter-spacing:0.2px}
.clock{background:var(--card);border-radius:12px;padding:26px;display:flex;flex-direction:column;align-items:center;gap:12px;min-height:220px}
.time{font-size:64px;font-weight:700;letter-spacing:1px}
.mode{display:flex;gap:8px;flex-wrap:wrap;justify-content:center}
button.mode-btn{background:transparent;border:1px solid rgba(255,255,255,0.2);color:var(--text-muted);padding:8px 12px;border-radius:10px;cursor:pointer}
button.mode-btn.active{border-color: var(--mode-active); color: var(--mode-active); box-shadow:0 6px 18px rgba(255,140,66,0.3)}
.controls{display:flex;gap:8px;margin-top:6px}
.btn{padding:10px 14px;border-radius:10px;border:0;cursor:pointer;font-weight:600}
.btn.start{background:var(--accent-gradient);color:white}
.btn.pause{background:rgba(0,0,0,0.3);color:var(--text-main)}
#fullscreenBtn,#themeToggleBtn{background:rgba(255,255,255,0.2);color:var(--text-main)}
.small{font-size:13px;color:var(--text-muted)}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <h1>番茄钟 · 可倒计时版</h1>
    <div class="small">快捷键: 空格 开始/暂停 · R 重置 · F 全屏</div>
  </header>

  <main class="clock">
    <div id="timeDisplay" class="time">25:00</div>
    <div id="statusLabel" class="small">专注 (25 分钟)</div>
    <div class="mode">
      <button class="mode-btn active" data-mode="focus">专注</button>
      <button class="mode-btn" data-mode="short">短休息</button>
      <button class="mode-btn" data-mode="long">长休息</button>
    </div>
    <div class="controls">
      <button class="btn start" id="startBtn">开始</button>
      <button class="btn pause" id="pauseBtn" style="display:none">暂停</button>
      <button class="btn" id="resetBtn">重置</button>
      <button class="btn" id="fullscreenBtn">全屏</button>
      <button class="btn" id="themeToggleBtn">切换日夜</button>
      <div style="margin-left:auto" class="small">周期: <span id="cycleCount">0</span></div>
    </div>
  </main>
</div>

<script>
let running=false;
let timer=null;
let timeLeft=25*60; // 初始 25 分钟
let cycleCount=0;
const modes = { focus:25, short:5, long:15 };
let currentMode='focus';

const startBtn=document.getElementById('startBtn');
const pauseBtn=document.getElementById('pauseBtn');
const resetBtn=document.getElementById('resetBtn');
const timeDisplay=document.getElementById('timeDisplay');
const statusLabel=document.getElementById('statusLabel');
const cycleDisplay=document.getElementById('cycleCount');
const modeButtons=document.querySelectorAll('.mode-btn');

// 更新显示
function updateDisplay(){
  let m=Math.floor(timeLeft/60);
  let s=timeLeft%60;
  timeDisplay.textContent=`${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
  statusLabel.textContent= currentMode==='focus' ? `专注 (${modes.focus} 分钟)` :
                         currentMode==='short'? `短休息 (${modes.short} 分钟)` :
                         `长休息 (${modes.long} 分钟)`;
}

// 切换模式
modeButtons.forEach(btn=>{
  btn.addEventListener('click', ()=>{
    modeButtons.forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    currentMode=btn.dataset.mode;
    timeLeft=modes[currentMode]*60;
    updateDisplay();
    resetTimer();
  });
});

// 开始/暂停/重置
function tick(){
  if(timeLeft>0){ timeLeft--; updateDisplay(); }
  else{ cycleCount++; cycleDisplay.textContent=cycleCount; clearInterval(timer); running=false; startBtn.style.display='inline-block'; pauseBtn.style.display='none'; }
}
function startTimer(){ if(!running){running=true; timer=setInterval(tick,1000); startBtn.style.display='none'; pauseBtn.style.display='inline-block'; } }
function pauseTimer(){ if(running){running=false; clearInterval(timer); startBtn.style.display='inline-block'; pauseBtn.style.display='none'; } }
function resetTimer(){ clearInterval(timer); running=false; timeLeft=modes[currentMode]*60; updateDisplay(); startBtn.style.display='inline-block'; pauseBtn.style.display='none'; }

startBtn.addEventListener('click', startTimer);
pauseBtn.addEventListener('click', pauseTimer);
resetBtn.addEventListener('click', resetTimer);

// 快捷键
document.addEventListener('keydown', e=>{
  if(e.code==='Space'){ e.preventDefault(); running?pauseTimer():startTimer(); }
  if(e.key==='r'||e.key==='R'){ resetTimer(); }
});

// --- 全屏功能 ---
const fullscreenBtn = document.getElementById('fullscreenBtn');
function toggleFullscreen(){
  if(!document.fullscreenElement){document.documentElement.requestFullscreen().then(()=>{fullscreenBtn.textContent='退出全屏';}).catch(console.error);}
  else{document.exitFullscreen().then(()=>{fullscreenBtn.textContent='全屏';}).catch(console.error);}
}
fullscreenBtn.addEventListener('click',toggleFullscreen);
document.addEventListener('keydown',e=>{if(e.key==='f'||e.key==='F'){e.preventDefault();toggleFullscreen();}});
document.addEventListener('fullscreenchange',()=>{fullscreenBtn.textContent=document.fullscreenElement?'退出全屏':'全屏';});

// --- 白天/夜晚模式切换 ---
const themeBtn = document.getElementById('themeToggleBtn');
function toggleTheme(){
  const current = document.documentElement.getAttribute('data-theme') || 'dark';
  const next = current==='light'?'dark':'light';
  document.documentElement.setAttribute('data-theme', next);
  localStorage.setItem('theme', next);
}
document.addEventListener('DOMContentLoaded',()=>{
  const saved = localStorage.getItem('theme') || 'dark';
  document.documentElement.setAttribute('data-theme', saved);
});
themeBtn.addEventListener('click', toggleTheme);

// 初始化显示
updateDisplay();
cycleDisplay.textContent=cycleCount;
</script>
</body>
</html>