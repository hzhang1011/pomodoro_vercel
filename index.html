<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pomodoro Timer</title>
<style>
:root {
  --bg: #fefefe;
  --text: #333;
  --focus: #ff4d4f;
  --short: #00bcd4;
  --long: #4caf50;
  --btn-bg: rgba(50,50,50,0.6);
  --btn-text: #fff;
}
[data-theme="dark"] {
  --bg: #1b1b1b;
  --text: #f0f0f0;
  --btn-bg: rgba(255,255,255,0.2);
}

body {
  font-family: 'Segoe UI', sans-serif;
  background: var(--bg);
  color: var(--text);
  margin: 0;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-start; /* ÁßªÂä®Á´ØÈù†‰∏ä */
  padding-top: 20px; /* È°∂ÈÉ®Â∞èÁ©∫Èöô */
  transition: background 0.3s, color 0.3s;
}

/* ===== Container ===== */
.container {
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 10px 15px; /* ÁßªÂä®Á´Ø padding Áº©Â∞è */
}
@media(min-width: 800px) {
  .container {
    flex-direction: row;
    justify-content: center;
    gap: 50px;
  }
}

/* ===== Frosted Glass Cards ===== */
.card {
  backdrop-filter: blur(12px) saturate(180%);
  background: rgba(255,255,255,0.2);
  border-radius: 20px;
  padding: 20px;
  margin: 10px 0;
  box-shadow: 0 8px 32px rgba(0,0,0,0.1);
  display: flex;
  flex-direction: column;
  align-items: center;
  min-width: 280px;
}

/* ===== Mode Buttons ===== */
.mode-buttons {
  display: flex;
  gap: 12px;
  justify-content: center;
  margin-bottom: 20px;
}
.mode-buttons button {
  border: none;
  border-radius: 12px;
  padding: 10px 20px;
  font-size: 16px;
  cursor: pointer;
  color: var(--btn-text);
  background: var(--btn-bg);
  transition: transform 0.1s, background 0.2s;
}
.mode-buttons button.active { background: var(--focus);}
.mode-buttons button:active { transform: scale(0.95); }

/* ===== Timer Display ===== */
.time {
  font-size: 80px; /* ÊâãÊú∫Á´ØÈÄÇÂΩìÁº©Â∞è */
  font-weight: bold;
  margin: 15px 0 20px 0;
  user-select: none;
}

/* ===== Control Buttons ===== */
.buttons {
  display: flex;
  gap: 10px; /* Áº©Â∞èÊåâÈíÆÈó¥Ë∑ù */
  justify-content: center;
}
.buttons button {
  padding: 12px 26px;
  font-size: 18px;
  border-radius: 12px;
  border: none;
  cursor: pointer;
  color: var(--btn-text);
  background: var(--btn-bg);
  transition: transform 0.1s;
}
.buttons button:active { transform: scale(0.95); }

/* ===== Sidebar ===== */
.sidebar {
  text-align: center;
  margin-top: 15px;
  width: 100%;
}
@media(min-width:800px) {
  .sidebar { margin-top:0; }
}
.sidebar p, .sidebar button {
  margin: 8px 0;
  color: var(--text);
}
.sidebar button {
  padding: 10px 20px;
  border: none;
  border-radius: 10px;
  background: var(--btn-bg);
  color: var(--btn-text);
  cursor: pointer;
}

/* ===== Overlay for sound activation ===== */
#enableSoundOverlay{
  position: fixed; inset:0;
  background: #000c;
  color: #fff;
  display: flex; align-items: center; justify-content: center;
  z-index: 9999;
  font-size: 22px;
  cursor: pointer;
}
</style>
</head>
<body>
<div id="enableSoundOverlay">üîä Click to enable sound</div>

<div class="container">
  <div class="card main">
    <div class="mode-buttons">
      <button data-mode="focus" class="active">Focus</button>
      <button data-mode="short">Short Break</button>
      <button data-mode="long">Long Break</button>
    </div>
    <div class="time" id="time">25:00</div>
    <div class="buttons">
      <button id="start">Start</button>
      <button id="pause" style="display:none;">Pause</button>
      <button id="reset">Reset</button>
      <button id="toggleTheme">Theme</button>
    </div>
  </div>

  <div class="card sidebar">
    <p>Cycles: <span id="cycles">0</span></p>
    <p>Total Focus: <span id="minutes">0</span> min</p>
    <button id="resetStats">Reset Stats</button>
  </div>
</div>

<audio id="alarmFocus" src="https://assets.mixkit.co/sfx/preview/mixkit-alarm-digital-clock-beep-989.mp3"></audio>
<audio id="alarmShort" src="https://assets.mixkit.co/sfx/preview/mixkit-bell-notification-933.mp3"></audio>
<audio id="alarmLong" src="https://assets.mixkit.co/sfx/preview/mixkit-retro-game-notification-212.mp3"></audio>

<script>
const timeDisplay = document.getElementById('time');
const startBtn = document.getElementById('start');
const pauseBtn = document.getElementById('pause');
const resetBtn = document.getElementById('reset');
const toggleThemeBtn = document.getElementById('toggleTheme');
const modeButtons = document.querySelectorAll('.mode-buttons button');
const cycleSidebar = document.getElementById('cycles');
const minutesSidebar = document.getElementById('minutes');
const alarmFocus = document.getElementById('alarmFocus');
const alarmShort = document.getElementById('alarmShort');
const alarmLong = document.getElementById('alarmLong');
const overlay = document.getElementById('enableSoundOverlay');

let currentMode='focus';
let timeLeft=25*60;
let timer=null;
let running=false;
let focusCount=0;
let modes={focus:25,short:5,long:15};
let cycleCount=parseInt(localStorage.getItem('cycleCount'))||0;
let totalMinutes=parseInt(localStorage.getItem('totalMinutes'))||0;
cycleSidebar.textContent=cycleCount;
minutesSidebar.textContent=totalMinutes;

// Request notification
if('Notification' in window){ Notification.requestPermission(); }

// Enable sound
overlay.addEventListener('click',()=>{
  [alarmFocus,alarmShort,alarmLong].forEach(a=>{a.play().catch(()=>{}); a.pause(); a.currentTime=0;});
  overlay.style.display='none';
});

function notifyUser(title,text){
  if(Notification.permission==='granted') new Notification(title,{body:text});
}

function updateDisplay(){
  const m=Math.floor(timeLeft/60);
  const s=timeLeft%60;
  timeDisplay.textContent=`${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
}

function startTimer(){
  if(running)return;
  running=true;
  startBtn.style.display='none'; pauseBtn.style.display='inline-block';
  timer=setInterval(()=>{
    timeLeft--; updateDisplay();
    if(timeLeft<=0){ clearInterval(timer); finishTimer(); }
  },1000);
}

function pauseTimer(){
  running=false; clearInterval(timer);
  startBtn.style.display='inline-block';
  pauseBtn.style.display='none';
}

function resetTimer(){
  clearInterval(timer); running=false;
  startBtn.style.display='inline-block';
  pauseBtn.style.display='none';
  timeLeft=modes[currentMode]*60;
  updateDisplay();
  [alarmFocus,alarmShort,alarmLong].forEach(a=>{a.pause();a.currentTime=0;});
}

function finishTimer(){
  if(currentMode==='focus'){
    totalMinutes+=modes.focus; focusCount++; cycleCount++;
    localStorage.setItem('cycleCount',cycleCount);
    localStorage.setItem('totalMinutes',totalMinutes);
    cycleSidebar.textContent=cycleCount;
    minutesSidebar.textContent=totalMinutes;
    alarmFocus.currentTime=0; alarmFocus.play().catch(()=>{});
    notifyUser('Pomodoro','Focus finished! Take a break.');
    if(focusCount%4===0){ switchMode('long',true); }
    else { switchMode('short',true); }
  }else{
    if(currentMode==='short'){ alarmShort.currentTime=0; alarmShort.play().catch(()=>{});}
    else { alarmLong.currentTime=0; alarmLong.play().catch(()=>{});}
    running=false;
    startBtn.style.display='inline-block';
    pauseBtn.style.display='none';
    currentMode='focus';
    timeLeft=modes.focus*60;
    modeButtons.forEach(b=>b.classList.toggle('active',b.dataset.mode==='focus'));
    notifyUser('Pomodoro','Break finished. Start focus manually.');
    updateDisplay();
  }
}

function switchMode(mode,autoStart=false){
  currentMode=mode;
  timeLeft=modes[mode]*60;
  modeButtons.forEach(b=>b.classList.toggle('active',b.dataset.mode===mode));
  updateDisplay();
  if(autoStart) startTimer();
}

resetBtn.onclick=resetTimer;
startBtn.onclick=startTimer;
pauseBtn.onclick=pauseTimer;
toggleThemeBtn.onclick=()=>{document.body.dataset.theme=document.body.dataset.theme==='dark'?'':'dark';};
modeButtons.forEach(btn=>btn.addEventListener('click',()=>switchMode(btn.dataset.mode,false)));
document.getElementById('resetStats').addEventListener('click',()=>{
  if(confirm('Reset all stats?')){
    cycleCount=0; totalMinutes=0;
    localStorage.removeItem('cycleCount');
    localStorage.removeItem('totalMinutes');
    cycleSidebar.textContent=0;
    minutesSidebar.textContent=0;
  }
});
updateDisplay();
</script>
</body>
</html>