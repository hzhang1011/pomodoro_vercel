<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Pomodoro ç•ªèŒ„é’Ÿ</title>
<style>
:root {
  --bg-gradient: linear-gradient(135deg, #6dd5ed, #2193b0);
  --card: rgba(255,255,255,0.1);
  --accent-gradient: linear-gradient(90deg,#ff6b6b,#ff8c42);
  --text-main: #fff;
  --text-muted: #fff3b0;
  --mode-active: #ffd166;
}
[data-theme="dark"] {
  --bg-gradient: linear-gradient(135deg, #0f1724, #1e293b);
  --card: rgba(255,255,255,0.05);
  --accent-gradient: linear-gradient(90deg,#ff6b6b,#ff8c42);
  --text-main: #e6eef6;
  --text-muted: #94a3b8;
  --mode-active: #ffd166;
}
[data-theme="light"] {
  --bg-gradient: linear-gradient(135deg, #a1c4fd, #c2e9fb);
  --card: rgba(255,255,255,0.8);
  --accent-gradient: linear-gradient(90deg,#ff8c42,#ff6b6b);
  --text-main: #1e293b;
  --text-muted: #475569;
  --mode-active: #ff8c42;
}

*{box-sizing:border-box;}
body{
  margin:0;
  font-family: Inter,ui-sans-serif,system-ui,-apple-system,"Helvetica Neue",Arial;
  background: var(--bg-gradient);
  color: var(--text-main);
  display:flex;
  align-items:center;
  justify-content:center;
  height:100vh;
}
.wrap{
  width:min(900px,95%);
  padding:28px;
  background: var(--card);
  border-radius:14px;
  box-shadow:0 8px 30px rgba(0,0,0,0.3);
  display:grid;
  grid-template-columns:1fr 250px;
  gap:18px;
}
@media (max-width:820px){.wrap{grid-template-columns:1fr;padding:18px}}
header{grid-column:1/-1;display:flex;align-items:center;justify-content:space-between;gap:12px}
h1{margin:0;font-size:18px;letter-spacing:0.2px}
.clock{background:var(--card);border-radius:12px;padding:26px;display:flex;flex-direction:column;align-items:center;gap:12px;min-height:220px}
.time{font-size:64px;font-weight:700;letter-spacing:1px}
.mode{display:flex;gap:8px;flex-wrap:wrap;justify-content:center}
button.mode-btn{background:transparent;border:1px solid rgba(255,255,255,0.2);color:var(--text-muted);padding:8px 12px;border-radius:10px;cursor:pointer}
button.mode-btn.active{border-color: var(--mode-active); color: var(--mode-active); box-shadow:0 6px 18px rgba(255,140,66,0.3)}
.controls{display:flex;gap:8px;margin-top:6px;flex-wrap:wrap}
.btn{
  padding:10px 14px;
  border-radius:10px;
  border:0;
  cursor:pointer;
  font-weight:600;
  background: var(--accent-gradient);
  color: #fff;
  transition: transform 0.1s;
}
.btn:hover{ transform: translateY(-2px);}
.small{font-size:13px;color:var(--text-muted)}

.sidebar{
  background:var(--card);
  padding:16px;
  border-radius:12px;
  display:flex;
  flex-direction:column;
  gap:12px;
}
.sidebar h2{
  margin:0 0 8px 0;
  font-size:16px;
  color:var(--text-main);
}
.sidebar-item{
  font-size:14px;
  color:var(--text-muted);
}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <h1>Pomodoroç•ªèŒ„é’Ÿ</h1>
    <div class="small">å¿«æ·é”®: ç©ºæ ¼ å¼€å§‹/æš‚åœ Â· R é‡ç½® Â· F å…¨å±</div>
  </header>

  <main class="clock">
    <div id="timeDisplay" class="time">25:00</div>
    <div id="statusLabel" class="small">ä¸“æ³¨ (25 åˆ†é’Ÿ)</div>
    <div class="mode">
      <button class="mode-btn active" data-mode="focus">ä¸“æ³¨</button>
      <button class="mode-btn" data-mode="short">çŸ­ä¼‘æ¯</button>
      <button class="mode-btn" data-mode="long">é•¿ä¼‘æ¯</button>
    </div>
    <div class="controls">
      <button class="btn start" id="startBtn">å¼€å§‹</button>
      <button class="btn pause" id="pauseBtn" style="display:none">æš‚åœ</button>
      <button class="btn" id="resetBtn">é‡ç½®</button>
      <button class="btn" id="fullscreenBtn">å…¨å±</button>
      <button class="btn" id="themeToggleBtn">åˆ‡æ¢æ—¥å¤œ</button>
    </div>
  </main>

  <aside class="sidebar">
    <h2>ä»Šæ—¥ç»Ÿè®¡</h2>
    <div class="sidebar-item">ä¸“æ³¨å‘¨æœŸ: <span id="cycleSidebar">0</span></div>
    <div class="sidebar-item">ä¸“æ³¨æ€»åˆ†é’Ÿ: <span id="minutesSidebar">0</span> åˆ†é’Ÿ</div>

    <h2>å°æç¤º</h2>
    <div class="sidebar-item">å–æ°´æé†’ ğŸ’§</div>
    <div class="sidebar-item">æ·±å‘¼å¸ 1 åˆ†é’Ÿ ğŸŒ¬ï¸</div>
  </aside>
</div>

<audio id="alarmFocus" src="focus.mp3" preload="auto"></audio>
<audio id="alarmShort" src="short.mp3" preload="auto"></audio>
<audio id="alarmLong" src="long.mp3" preload="auto"></audio>

<script>
let running=false, timer=null, timeLeft=25*60;
let cycleCount=0, totalMinutes=0, focusCount=0;
const modes={focus:25, short:5, long:15};
let currentMode='focus';

const startBtn=document.getElementById('startBtn');
const pauseBtn=document.getElementById('pauseBtn');
const resetBtn=document.getElementById('resetBtn');
const timeDisplay=document.getElementById('timeDisplay');
const statusLabel=document.getElementById('statusLabel');
const cycleSidebar=document.getElementById('cycleSidebar');
const minutesSidebar=document.getElementById('minutesSidebar');
const modeButtons=document.querySelectorAll('.mode-btn');

const alarmFocus=document.getElementById('alarmFocus');
const alarmShort=document.getElementById('alarmShort');
const alarmLong=document.getElementById('alarmLong');

function formatTime(sec){
  let m=Math.floor(sec/60), s=sec%60;
  return `${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
}

function updateDisplay(){
  timeDisplay.textContent = formatTime(timeLeft);
  statusLabel.textContent = currentMode==='focus'?`ä¸“æ³¨ (${modes.focus} åˆ†é’Ÿ)`:
                         currentMode==='short'?`çŸ­ä¼‘æ¯ (${modes.short} åˆ†é’Ÿ)`:
                         `é•¿ä¼‘æ¯ (${modes.long} åˆ†é’Ÿ)`;
}

modeButtons.forEach(btn=>{
  btn.addEventListener('click',()=>{
    modeButtons.forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    currentMode=btn.dataset.mode;
    timeLeft=modes[currentMode]*60;
    updateDisplay();
    resetTimer();
    focusCount=0; 
  });
});

function startTimer(){
  if(!running){
    running=true;
    startBtn.style.display='none';
    pauseBtn.style.display='inline-block';
    let prevTime=Date.now();
    function tick(){
      if(!running) return;
      const now=Date.now();
      const delta=Math.floor((now-prevTime)/1000);
      if(delta>=1){
        timeLeft=Math.max(0, timeLeft-delta);
        prevTime=now;
        updateDisplay();
        if(timeLeft<=0){ finishTimer(); return; }
      }
      requestAnimationFrame(tick);
    }
    requestAnimationFrame(tick);
  }
}

function pauseTimer(){
  if(running){
    running=false;
    startBtn.style.display='inline-block';
    pauseBtn.style.display='none';
  }
}

function resetTimer(){
  running=false;
  timeLeft=modes[currentMode]*60;
  updateDisplay();
  startBtn.style.display='inline-block';
  pauseBtn.style.display='none';
  [alarmFocus, alarmShort, alarmLong].forEach(a=>{a.pause();a.currentTime=0;});
}

function switchMode(mode, autoStart=false){
  currentMode=mode;
  timeLeft=modes[mode]*60;
  modeButtons.forEach(b=>b.classList.toggle('active', b.dataset.mode===mode));
  updateDisplay();
  if(autoStart) startTimer();
}

function finishTimer(){
  if(currentMode==='focus'){
    totalMinutes+=modes.focus;
    focusCount++;
    alarmFocus.currentTime=0; alarmFocus.play();
    if(focusCount%4===0){ switchMode('long', true); }
    else { switchMode('short', true); }
  } else {
    if(currentMode==='short'){ alarmShort.currentTime=0; alarmShort.play(); }
    else { alarmLong.currentTime=0; alarmLong.play(); }
    running=false;
    startBtn.style.display='inline-block';
    pauseBtn.style.display='none';
    currentMode='focus';
    timeLeft=modes.focus*60;
    modeButtons.forEach(b=>b.classList.toggle('active', b.dataset.mode==='focus'));
    updateDisplay();
  }
  cycleCount++;
  cycleSidebar.textContent=cycleCount;
  minutesSidebar.textContent=totalMinutes;
}

startBtn.addEventListener('click', startTimer);
pauseBtn.addEventListener('click', pauseTimer);
resetBtn.addEventListener('click', resetTimer);

document.addEventListener('keydown', e=>{
  if(e.code==='Space'){ e.preventDefault(); running?pauseTimer():startTimer(); }
  if(e.key==='r'||e.key==='R'){ resetTimer(); }
});

// å…¨å±
const fullscreenBtn=document.getElementById('fullscreenBtn');
fullscreenBtn.addEventListener('click', ()=>{
  if(!document.fullscreenElement){document.documentElement.requestFullscreen();}
  else{document.exitFullscreen();}
});
document.addEventListener('keydown', e=>{if(e.key==='f'||e.key==='F'){e.preventDefault(); fullscreenBtn.click();}});

// æ—¥å¤œæ¨¡å¼
const themeBtn=document.getElementById('themeToggleBtn');
themeBtn.addEventListener('click', ()=>{
  const current=document.documentElement.getAttribute('data-theme')||'dark';
  const next=current==='light'?'dark':'light';
  document.documentElement.setAttribute('data-theme',next);
  localStorage.setItem('theme',next);
});

document.addEventListener('DOMContentLoaded', ()=>{
  const saved=localStorage.getItem('theme')||'dark';
  document.documentElement.setAttribute('data-theme',saved);
  updateDisplay();
  cycleSidebar.textContent=cycleCount;
  minutesSidebar.textContent=totalMinutes;
});
</script>
</body>
</html>